---
stages:
  - quality
  - test
  - deploy

eslint:
  stage: quality
  image: node:17-alpine
  script:
    - apk add git make bash inotify-tools
    - make install_prereqs
    - make quality

tests-node17:
  stage: test
  image: node:17-alpine
  script:
    - apk add git make bash inotify-tools
    - make install_prereqs
    - make test

tests-node16:
  stage: test
  image: node:16-alpine
  script:
    - apk add git make bash inotify-tools
    - make install_prereqs
    - make test

documentation:
  stage: test
  image: nikolaik/python-nodejs:python3.8-nodejs16-alpine
  script:
    - apk add git make bash inotify-tools
    - npm install
    - pip install -r docs/requirements.txt
    - pip install docs/
    - cd docs && make html

npm_push:
  stage: deploy
  image: node:17-alpine
  only:
    - master
  script:
    - apk add git make bash inotify-tools
    - make install_prereqs
    - npm config set //registry.npmjs.org/:_authToken ${NPM_TOKEN}
    - make publish